//
//  VirusWalkState.swift
//  Malware Mind
//
//  Created by Pedro Henrique on 06/04/21.
//

import UIKit
import SpriteKit
import GameplayKit

class VirusWalkState: VirusBaseState {

    override init(game: GameScene, entity: BaseGridEntity, goal: BaseGridEntity) {
        super.init(game: game, entity: entity, goal: goal)
    }
    
    func pathToGoal() -> [GKGridGraphNode] {
        if let graph = self.game.level.pathfindingGraph,
           let goalGridPosition = self.enemyGoal.gridPosition,
           let goalNode = graph.node(atGridPosition: goalGridPosition) {
            return self.path(to: goalNode) ?? []
        }
        return []
    }

    var animationComponent: AnimatedSpriteComponent? {
        self.entity.component(ofType: AnimatedSpriteComponent.self)
    }

    override func didEnter(from previousState: GKState?) {
        super.didEnter(from: previousState)

        switch entity {
        case is VirusEntity:
            animationComponent?.setAnimation(atlasName: "VirusIdle")
        default:
            animationComponent?.setAnimation(atlasName: "WormWalk")
        }
    }
    
    override func update(deltaTime seconds: TimeInterval) {
        super.update(deltaTime: seconds)
        
        self.start(followingPath: self.pathToGoal())
    }
    
}
