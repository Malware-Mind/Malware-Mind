//
//  VirusWalkState.swift
//  Malware Mind
//
//  Created by Pedro Henrique on 18/03/21.
//

import UIKit
import SpriteKit
import GameplayKit

//Provavelmente pode virar um WalkState genÃ©rico depois
class VirusWalkState: VirusBaseState {

    override init(game: GameScene, entity: BaseEntity) {
        super.init(game: game, entity: entity)
    }
    
    func pathToCollect() -> [GKGridGraphNode] {
        if let graph = self.game.level.pathfindingGraph,
           let collectGridPosition = self.game.collectEntity.gridPosition,
           let collectNode = graph.node(atGridPosition: collectGridPosition) {
            return self.path(to: collectNode) ?? []
        }
        return []
    }

    var animationComponent: AnimatedSpriteComponent? {
        self.entity.component(ofType: AnimatedSpriteComponent.self)
    }

    override func didEnter(from previousState: GKState?) {
        super.didEnter(from: previousState)

        switch entity {
        case is VirusEntity:
            animationComponent?.setAnimation(atlasName: "VirusIdle")
        default:
            animationComponent?.setAnimation(atlasName: "WormWalk")
        }
    }
    
    override func update(deltaTime seconds: TimeInterval) {
        super.update(deltaTime: seconds)

        self.start(followingPath: self.pathToCollect())
    }
    
}
